const Q=function(){return 2===arguments.length&&Array.from(arguments).every(function(t){return Q.isUsefulInteger(t)})?new Q.Circuit(arguments[0],arguments[1]):Q.Circuit.fromText(arguments[0])};function updateCircuitParts(t){var e=document.getElementById(t.name+"-latex"),e=(e&&(e.innerText="\n"+t.toLatex(!0)),document.getElementById(t.name+"-diagram")),e=(e&&(e.innerText=t.toDiagram(!0)),document.getElementById(t.name+"-text")),e=(e&&(e.innerText=t.toText()),document.getElementById(t.name+"-report"));e&&(e.innerText=t.report$())}Object.assign(Q,{verbosity:.5,log:function(t,...e){return Q.verbosity>=t&&console.log(...e),"(log)"},warn:function(){return console.warn(...arguments),"(warn)"},error:function(){return console.error(...arguments),"(error)"},extractDocumentation:function(t){const e=(t=t.toString()).indexOf("`")+1,i=t.indexOf("`",e),r=t.substring(e,i).split("\n");let n=Number.MAX_SAFE_INTEGER;return r.forEach(function(t){t&&(t=function(t){let e=index=0;for(;"\t"===t.charAt(index++);)e++;return e}(t),n>t)&&(n=t)}),r.forEach(function(t,e){""===t.trim()&&(t="\n\n"),r[e]=t.substring(n).replace(/ {2}$/,"\n")}),r.join("")},help:function(t){return void 0===t&&(t=Q),Q.extractDocumentation(t)},constants:{},createConstant:function(t,e){this[t]=e,this.constants[t]=this[t],Object.freeze(this[t])},createConstants:function(){if(arguments.length%2!=0)return Q.error("Q attempted to create constants with invalid (KEY, VALUE) pairs.");for(let t=0;t<arguments.length;t+=2)this.createConstant(arguments[t],arguments[t+1])},isUsefulNumber:function(t){return!1===isNaN(t)&&("number"==typeof t||t instanceof Number)&&t!==1/0&&t!==-1/0},isUsefulInteger:function(t){return Q.isUsefulNumber(t)&&Number.isInteger(t)},loop:function(){},hypotenuse:function(t,e){let i=Math.abs(t),r=Math.abs(e);return i<2048&&r<2048?Math.sqrt(i*i+r*r):(r=i<r?(i=r,t/e):e/t,i*Math.sqrt(1+r*r))},logHypotenuse:function(t,e){var i=Math.abs(t),r=Math.abs(e);return 0===t?Math.log(r):0===e?Math.log(i):i<2048&&r<2048?Math.log(t*t+e*e)/2:Math.log(t/Math.cos(Math.atan2(e,t)))},hyperbolicSine:function(t){return(Math.exp(t)-Math.exp(-t))/2},hyperbolicCosine:function(t){return(Math.exp(t)+Math.exp(-t))/2},round:function(t,e){"number"!=typeof e&&(e=0);e=Math.pow(10,e);return Math.round(t*e)/e},toTitleCase:function(t){return(t=t.replace(/_/g," ")).toLowerCase().split(" ").map(function(t){return t.replace(t[0],t[0].toUpperCase())}).join(" ")},centerText:function(t,e,i){var r;return e>t.length?("string"!=typeof i&&(i=" "),r=Math.floor((e-t.length)/2),t.length,t.padStart(r+t.length,i).padEnd(e,i)):t},namesIndex:0,shuffledNames:[],shuffleNames$:function(){var i=[];for(let e=0;e<Q.COLORS.length;e++)for(let t=0;t<Q.ANIMALS.length;t++)i.push([e,t,Math.random()]);Q.shuffledNames=i.sort(function(t,e){return t[2]-e[2]})},getRandomName$:function(){0===Q.shuffledNames.length&&Q.shuffleNames$();var t=Q.shuffledNames[Q.namesIndex],t=Q.COLORS[t[0]]+" "+Q.ANIMALS[t[1]];return Q.namesIndex=(Q.namesIndex+1)%Q.shuffledNames.length,t},hueToColorName:function(t){return t%=360,t=Math.floor(t/10),Q.COLORS[t]},colorIndexToHue:function(t){return 10*t}}),Q.createConstants("REVISION",19,"EPSILON",6*Number.EPSILON,"RADIANS_TO_DEGREES",180/Math.PI,"ANIMALS",["Aardvark","Albatross","Alligator","Alpaca","Ant","Anteater","Antelope","Ape","Armadillo","Baboon","Badger","Barracuda","Bat","Bear","Beaver","Bee","Bison","Boar","Buffalo","Butterfly","Camel","Caribou","Cat","Caterpillar","Cattle","Chamois","Cheetah","Chicken","Chimpanzee","Chinchilla","Chough","Clam","Cobra","Cod","Cormorant","Coyote","Crab","Crane","Crocodile","Crow","Curlew","Deer","Dinosaur","Dog","Dogfish","Dolphin","Donkey","Dotterel","Dove","Dragonfly","Duck","Dugong","Dunlin","Eagle","Echidna","Eel","Eland","Elephant","Elephant seal","Elk","Emu","Falcon","Ferret","Finch","Fish","Flamingo","Fly","Fox","Frog","Galago","Gaur","Gazelle","Gerbil","Giant Panda","Giraffe","Gnat","Gnu","Goat","Goose","Goldfinch","Goldfish","Gorilla","Goshawk","Grasshopper","Grouse","Guanaco","Guinea fowl","Guinea pig","Gull","Guppy","Hamster","Hare","Hawk","Hedgehog","Hen","Heron","Herring","Hippopotamus","Hornet","Horse","Human","Hummingbird","Hyena","Ide","Jackal","Jaguar","Jay","Jellyfish","Kangaroo","Koala","Koi","Komodo dragon","Kouprey","Kudu","Lapwing","Lark","Lemur","Leopard","Lion","Llama","Lobster","Locust","Loris","Louse","Lyrebird","Magpie","Mallard","Manatee","Marten","Meerkat","Mink","Mole","Monkey","Moose","Mouse","Mosquito","Mule","Narwhal","Newt","Nightingale","Octopus","Okapi","Opossum","Oryx","Ostrich","Otter","Owl","Ox","Oyster","Panther","Parrot","Partridge","Peafowl","Pelican","Penguin","Pheasant","Pig","Pigeon","Pony","Porcupine","Porpoise","Prairie Dog","Quail","Quelea","Rabbit","Raccoon","Rail","Ram","Raven","Reindeer","Rhinoceros","Rook","Ruff","Salamander","Salmon","Sand Dollar","Sandpiper","Sardine","Scorpion","Sea lion","Sea Urchin","Seahorse","Seal","Shark","Sheep","Shrew","Shrimp","Skunk","Snail","Snake","Sow","Spider","Squid","Squirrel","Starling","Stingray","Stinkbug","Stork","Swallow","Swan","Tapir","Tarsier","Termite","Tiger","Toad","Trout","Tui","Turkey","Turtle","Vicuña","Viper","Vulture","Wallaby","Walrus","Wasp","Water buffalo","Weasel","Whale","Wolf","Wolverine","Wombat","Woodcock","Woodpecker","Worm","Wren","Yak","Zebra"],"ANIMALS3",["ape","bee","cat","dog","elk","fox","gup","hen","ide","jay","koi","leo","moo","nit","owl","pig","ram","sow","tui","yak","zeb"],"COLORS",["Red","Scarlet","Tawny","Carrot","Pumpkin","Mustard","Lemon","Lime","Spring bud","Spring grass","Pear","Kelly","Green","Malachite","Sea green","Sea foam","Aquamarine","Turquoise","Cyan","Pacific blue","Baby blue","Ocean blue","Sapphire","Azure","Blue","Cobalt","Indigo","Violet","Lavender","Purple","Magenta","Hot pink","Fuschia","Ruby","Crimson","Carmine"]),console.log(`


  QQQQQQ
QQ      QQ
QQ      QQ
QQ      QQ
QQ  QQ  QQ
QQ    QQ 
  QQQQ  ${Q.REVISION}    



https://quantumjavascript.app



`),Q.ComplexNumber=function(t,e){if(t instanceof Q.ComplexNumber?(e=t.imaginary,t=t.real,Q.warn("Q.ComplexNumber tried to create a new instance with an argument that is already a Q.ComplexNumber — and that’s weird!")):void 0===t&&(t=0),void 0===e&&(e=0),!0!==Q.ComplexNumber.isNumberLike(t)&&!0!==isNaN(t)||!0!==Q.ComplexNumber.isNumberLike(e)&&!0!==isNaN(e))return Q.error("Q.ComplexNumber attempted to create a new instance but the arguments provided were not actual numbers.");this.real=t,this.imaginary=e,this.index=Q.ComplexNumber.index++},Object.assign(Q.ComplexNumber,{index:0,help:function(){return Q.help(this)},constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,isNumberLike:function(t){return!1===isNaN(t)&&("number"==typeof t||t instanceof Number)},isNaN:function(t){return isNaN(t.real)||isNaN(t.imaginary)},isZero:function(t){return!(0!==t.real&&-0!==t.real||0!==t.imaginary&&-0!==t.imaginary)},isFinite:function(t){return isFinite(t.real)&&isFinite(t.imaginary)},isInfinite:function(t){return!(this.isNaN(t)||this.isFinite(t))},areEqual:function(t,e){return Q.ComplexNumber.operate("areEqual",t,e,function(t,e){return Math.abs(t-e)<Q.EPSILON},function(t,e){return Math.abs(t-e.real)<Q.EPSILON&&Math.abs(e.imaginary)<Q.EPSILON},function(t,e){return Math.abs(t.real-e)<Q.EPSILON&&Math.abs(t.imaginary)<Q.EPSILON},function(t,e){return Math.abs(t.real-e.real)<Q.EPSILON&&Math.abs(t.imaginary-e.imaginary)<Q.EPSILON})},absolute:function(t){return Q.hypotenuse(t.real,t.imaginary)},conjugate:function(t){return new Q.ComplexNumber(t.real,-1*t.imaginary)},operate:function(t,e,i,r,n,o,a){return Q.ComplexNumber.isNumberLike(e)?Q.ComplexNumber.isNumberLike(i)?r(e,i):i instanceof Q.ComplexNumber?n(e,i):Q.error("Q.ComplexNumber attempted to",t,"with the number",e,"and something that is neither a Number or Q.ComplexNumber:",i):e instanceof Q.ComplexNumber?Q.ComplexNumber.isNumberLike(i)?o(e,i):i instanceof Q.ComplexNumber?a(e,i):Q.error("Q.ComplexNumber attempted to",t,"with the complex number",e,"and something that is neither a Number or Q.ComplexNumber:",i):Q.error("Q.ComplexNumber attempted to",t,"with something that is neither a Number or Q.ComplexNumber:",e)},sine:function(t){var e=t.real,t=t.imaginary;return new Q.ComplexNumber(Math.sin(e)*Q.hyperbolicCosine(t),Math.cos(e)*Q.hyperbolicSine(t))},cosine:function(t){var e=t.real,t=t.imaginary;return new Q.ComplexNumber(Math.cos(e)*Q.hyperbolicCosine(t),-Math.sin(e)*Q.hyperbolicSine(t))},arcCosine:function(t){var e=t.real,t=t.imaginary,i=Q.ComplexNumber.squareRoot(new Q.ComplexNumber(t*t-e*e+1,e*t*-2)),t=Q.ComplexNumber.log(new Q.ComplexNumber(i.real-t,i.imaginary+e));return new Q.ComplexNumber(Math.PI/2-t.imaginary,t.real)},arcTangent:function(t){var e=t.real,t=t.imaginary;if(0===e){if(1===t)return new Q.ComplexNumber(0,1/0);if(-1===t)return new Q.ComplexNumber(0,-1/0)}var i=e*e+(1-t)*(1-t),t=Q.ComplexNumber.log(new Q.ComplexNumber((1-t*t-e*e)/i,e/i*-2));return new Q.ComplexNumber(t.imaginary/2,t.real/2)},power:function(t,e){if(Q.ComplexNumber.isNumberLike(t)&&(t=new Q.ComplexNumber(t)),(e=Q.ComplexNumber.isNumberLike(e)?new Q.ComplexNumber(e):e).isZero())return Q.ComplexNumber.ONE;if(t.isZero()&&0<e.real&&0<=e.imaginary)return Q.ComplexNumber.ZERO;if(0===e.imaginary){if(0<=t.real&&0===t.imaginary)return new Q.ComplexNumber(Math.pow(t.real,e.real),0);if(0===t.real)switch((e.real%4+4)%4){case 0:return new Q.ComplexNumber(Math.pow(t.imaginary,e.real),0);case 1:return new Q.ComplexNumber(0,Math.pow(t.imaginary,e.real));case 2:return new Q.ComplexNumber(-Math.pow(t.imaginary,e.real),0);case 3:return new Q.ComplexNumber(0,-Math.pow(t.imaginary,e.real))}}var i=Math.atan2(t.imaginary,t.real),r=Q.logHypotenuse(t.real,t.imaginary),n=Math.exp(e.real*r-e.imaginary*i),r=e.imaginary*r+e.real*i;return new Q.ComplexNumber(n*Math.cos(r),n*Math.sin(r))},squareRoot:function(t){var e=new Q.ComplexNumber(0,0),i=Q.ComplexNumber.absolute(t);return 0<=t.real?0===t.imaginary?e.real=Math.sqrt(t.real):e.real=Math.sqrt(2*(i+t.real))/2:e.real=Math.abs(t.imaginary)/Math.sqrt(2*(i-t.real)),t.real<=0?e.imaginary=Math.sqrt(2*(i-t.real))/2:e.imaginary=Math.abs(t.imaginary)/Math.sqrt(2*(i+t.real)),t.imaginary<0&&(e.imaginary*=-1),e},log:function(t){return new Q.ComplexNumber(Q.logHypotenuse(t.real,t.imaginary),Math.atan2(t.imaginary,t.real))},multiply:function(t,e){return Q.ComplexNumber.operate("multiply",t,e,function(t,e){return new Q.ComplexNumber(t*e)},function(t,e){return new Q.ComplexNumber(t*e.real,t*e.imaginary)},function(t,e){return new Q.ComplexNumber(t.real*e,t.imaginary*e)},function(t,e){var i=t.real*e.real,r=t.real*e.imaginary,n=t.imaginary*e.real,t=t.imaginary*e.imaginary*-1;return new Q.ComplexNumber(i+t,r+n)})},divide:function(t,e){return Q.ComplexNumber.operate("divide",t,e,function(t,e){return new Q.ComplexNumber(t/e)},function(t,e){return new Q.ComplexNumber(t).divide(e)},function(t,e){return new Q.ComplexNumber(t.real/e,t.imaginary/e)},function(t,e){var i=e.conjugate(),t=t.multiply(i),e=e.multiply(i).real;return t.divide(e)})},add:function(t,e){return Q.ComplexNumber.operate("add",t,e,function(t,e){return new Q.ComplexNumber(t+e)},function(t,e){return new Q.ComplexNumber(e.real+t,e.imaginary)},function(t,e){return new Q.ComplexNumber(t.real+e,t.imaginary)},function(t,e){return new Q.ComplexNumber(t.real+e.real,t.imaginary+e.imaginary)})},subtract:function(t,e){return Q.ComplexNumber.operate("subtract",t,e,function(t,e){return new Q.ComplexNumber(t-e)},function(t,e){return new Q.ComplexNumber(e.real-t,e.imaginary)},function(t,e){return new Q.ComplexNumber(t.real-e,t.imaginary)},function(t,e){return new Q.ComplexNumber(t.real-e.real,t.imaginary-e.imaginary)})}}),Q.ComplexNumber.createConstants("ZERO",new Q.ComplexNumber(0,0),"ONE",new Q.ComplexNumber(1,0),"E",new Q.ComplexNumber(Math.E,0),"PI",new Q.ComplexNumber(Math.PI,0),"I",new Q.ComplexNumber(0,1),"EPSILON",new Q.ComplexNumber(Q.EPSILON,Q.EPSILON),"INFINITY",new Q.ComplexNumber(1/0,1/0),"NAN",new Q.ComplexNumber(NaN,NaN)),Object.assign(Q.ComplexNumber.prototype,{clone:function(){return new Q.ComplexNumber(this.real,this.imaginary)},reduce:function(){return 0===this.imaginary?this.real:this},isNaN:function(t){return Q.ComplexNumber.isNaN(this)},isZero:function(t){return Q.ComplexNumber.isZero(this)},isFinite:function(t){return Q.ComplexNumber.isFinite(this)},isInfinite:function(t){return Q.ComplexNumber.isInfinite(this)},isEqualTo:function(t){return Q.ComplexNumber.areEqual(this,t)},absolute:function(){return Q.ComplexNumber.absolute(this)},conjugate:function(){return Q.ComplexNumber.conjugate(this)},power:function(t){return Q.ComplexNumber.power(this,t)},squareRoot:function(){return Q.ComplexNumber.squareRoot(this)},log:function(){return Q.ComplexNumber.log(this)},multiply:function(t){return Q.ComplexNumber.multiply(this,t)},divide:function(t){return Q.ComplexNumber.divide(this,t)},add:function(t){return Q.ComplexNumber.add(this,t)},subtract:function(t){return Q.ComplexNumber.subtract(this,t)},toText:function(t,e){e=!1===e?"":" ";var i=this.real,r=this.imaginary,t=("number"!=typeof t&&(t=3),Math.pow(10,t)),i=Math.round(i*t)/t,r=Math.round(r*t)/t,t=Math.abs(i),n=Math.abs(r);let o=t.toString(),a=n.toString();return 0==i?r==1/0?e+"∞i":r==-1/0?"-∞i":0==r?e+"0":-1==r?"-i":1==r?e+"i":0<=r?e+a+"i":r<0?"-"+a+"i":a+"i":(i==1/0?o=e+"∞":i==-1/0?o="-∞":0<=i?o=e+o:i<0&&(o="-"+o),r==1/0?o+" + ∞i":r==-1/0?o+" - ∞i":0==r?o:-1==r?o+" - i":1==r?o+" + i":!(0<r)&&r<0?o+" - "+a+"i":o+" + "+a+"i")},copy$:function(t){return t instanceof Q.ComplexNumber!=!0?Q.error(`Q.ComplexNumber attempted to copy something that was not a complex number in to this complex number #${this.index}.`,this):(this.real=t.real,this.imaginary=t.imaginary,this)},conjugate$:function(){return this.copy$(this.conjugate())},power$:function(t){return this.copy$(this.power(t))},squareRoot$:function(){return this.copy$(this.squareRoot())},log$:function(){return this.copy$(this.log())},multiply$:function(t){return this.copy$(this.multiply(t))},divide$:function(t){return this.copy$(this.divide(t))},add$:function(t){return this.copy$(this.add(t))},subtract$:function(t){return this.copy$(this.subtract(t))}}),Q.Matrix=function(){this.index=Q.Matrix.index++;let r=null;if(1==arguments.length&&Q.ComplexNumber.isNumberLike(arguments[0]))r=arguments[0],this.rows=new Array(r).fill(0).map(function(){return new Array(r).fill(0)});else if(2==arguments.length&&Q.ComplexNumber.isNumberLike(arguments[0])&&Q.ComplexNumber.isNumberLike(arguments[1]))r=arguments[0],this.rows=new Array(arguments[1]).fill(0).map(function(){return new Array(r).fill(0)});else{let e=!1;if(this.rows=Array.from(arguments),this.rows.forEach(function(t){t instanceof Array!=!0&&(t=[t]),null===r?r=t.length:r!==t.length&&(e=!0)}),e)return Q.error(`Q.Matrix found upon initialization that matrix#${this.index} row lengths were not equal. You are going to have a bad time.`,this)}const n=this;this.columns=[];for(let i=0;i<r;i++){var t=[];for(let e=0;e<this.rows.length;e++){var o=n.rows[e][i];if("number"==typeof o)n.rows[e][i]=new Q.ComplexNumber(o);else if(o instanceof Q.ComplexNumber==!1)return Q.error(`Q.Matrix found upon initialization that matrix#${this.index} contained non-quantitative values. A+ for creativity, but F for functionality.`,this);Object.defineProperty(t,e,{get:function(){return n.rows[e][i]},set:function(t){n.rows[e][i]=t}})}this.columns.push(t)}},Object.assign(Q.Matrix,{index:0,help:function(){return Q.help(this)},constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,isMatrixLike:function(t){return t instanceof this||this.prototype.isPrototypeOf(t)},isWithinRange:function(t,e,i){return"number"==typeof t&&e<=t&&t<=i&&t==parseInt(t)},getWidth:function(t){return t.columns.length},getHeight:function(t){return t.rows.length},haveEqualDimensions:function(t,e){return t.rows.length===e.rows.length&&t.columns.length===e.columns.length},areEqual:function(t,n){return t instanceof Q.Matrix==!0&&n instanceof Q.Matrix==!0&&!0===Q.Matrix.haveEqualDimensions(t,n)&&t.rows.reduce(function(t,e,r){return t&&e.reduce(function(t,e,i){return t&&e.isEqualTo(n.rows[r][i])},!0)},!0)},createSquare:function(i,r){"number"!=typeof i&&(i=2),"function"!=typeof r&&(r=function(){return 0});var t=[];for(let e=0;e<i;e++){var n=[];for(let t=0;t<i;t++)n.push(r(t,e));t.push(n)}return new Q.Matrix(...t)},createZero:function(t){return new Q.Matrix.createSquare(t)},createOne:function(t){return new Q.Matrix.createSquare(t,function(){return 1})},createIdentity:function(t){return new Q.Matrix.createSquare(t,function(t,e){return t===e?1:0})},from:function(t){"string"!=typeof t&&(t="Array");var e=Q.Matrix["from"+t];return t=t.toLowerCase(),"function"!=typeof e?Q.error(`Q.Matrix could not find an importer for “${t}” data.`):e},fromArray:function(t){return new Q.Matrix(...t)},fromXsv:function(t,e,i){"string"!=typeof i&&(i="\t");const r=t.split(e="string"!=typeof e?"\n":e),n=[];return r.forEach(function(t){if(""!==(t=t.trim())){const e=[];t.split(i).forEach(function(t){e.push(parseFloat(t))}),n.push(e)}}),new Q.Matrix(...n)},fromCsv:function(t){return Q.Matrix.fromXsv(t.replace(/\r/g,"\n"),"\n",",")},fromTsv:function(t){return Q.Matrix.fromXsv(t,"\n","\t")},fromHtml:function(t){return Q.Matrix.fromXsv(t.replace(/\r?\n|\r|<tr>|<td>/g,"").replace(/<\/td>(\s*)<\/tr>/g,"</tr>").match(/<table>(.*)<\/table>/i)[1],"</tr>","</td>")},toXsv:function(t,i,r){return t.rows.reduce(function(t,e){return t+i+e.reduce(function(t,e,i){return t+(0<i?r:"")+e.toText()},"")},"")},toCsv:function(t){return Q.Matrix.toXsv(t,"\n",",")},toTsv:function(t){return Q.Matrix.toXsv(t,"\n","\t")},add:function(t,n){return!0!==Q.Matrix.isMatrixLike(t)||!0!==Q.Matrix.isMatrixLike(n)?Q.error("Q.Matrix attempted to add something that was not a matrix."):!0!==Q.Matrix.haveEqualDimensions(t,n)?Q.error(`Q.Matrix cannot add matrix#${t.index} of dimensions ${t.columns.length}x${t.rows.length} to matrix#${n.index} of dimensions ${n.columns.length}x${n.rows.length}.`):new Q.Matrix(...t.rows.reduce(function(t,e,r){return t.push(e.reduce(function(t,e,i){return t.push(e.add(n.rows[r][i])),t},[])),t},[]))},multiplyScalar:function(t,i){return!0!==Q.Matrix.isMatrixLike(t)?Q.error("Q.Matrix attempted to scale something that was not a matrix."):"number"!=typeof i?Q.error(`Q.Matrix attempted to scale this matrix#${t.index} by an invalid scalar: ${i}.`):new Q.Matrix(...t.rows.reduce(function(t,e){return t.push(e.reduce(function(t,e){return t.push(e.multiply(i)),t},[])),t},[]))},multiply:function(t,i){if(!0!==Q.Matrix.isMatrixLike(t)||!0!==Q.Matrix.isMatrixLike(i))return Q.error("Q.Matrix attempted to multiply something that was not a matrix.");if(t.columns.length!==i.rows.length)return Q.error(`Q.Matrix attempted to multiply Matrix#${t.index}(cols==${t.columns.length}) by Matrix#${i.index}(rows==${i.rows.length}) but their dimensions were not compatible for this.`);const n=[];return t.rows.forEach(function(r){const e=[];i.columns.forEach(function(t){const i=new Q.ComplexNumber;t.forEach(function(t,e){i.add$(r[e].multiply(t))}),e.push(i)}),n.push(e)}),new this(...n)},multiplyTensor:function(i,r){if(!0!==Q.Matrix.isMatrixLike(i)||!0!==Q.Matrix.isMatrixLike(r))return Q.error("Q.Matrix attempted to tensor something that was not a matrix.");var t=[],n=i.columns.length*r.columns.length,o=i.rows.length*r.rows.length;for(let e=0;e<o;e++){var a=[];for(let t=0;t<n;t++){var s=Math.floor(t/i.columns.length),u=Math.floor(e/i.rows.length),c=t%r.columns.length,l=e%r.rows.length;a.push(i.rows[u][s].multiply(r.rows[l][c]))}t.push(a)}return new Q.Matrix(...t)}}),Object.assign(Q.Matrix.prototype,{isValidRow:function(t){return Q.Matrix.isWithinRange(t,0,this.rows.length-1)},isValidColumn:function(t){return Q.Matrix.isWithinRange(t,0,this.columns.length-1)},isValidAddress:function(t,e){return this.isValidRow(e)&&this.isValidColumn(t)},getWidth:function(){return Q.Matrix.getWidth(this)},getHeight:function(){return Q.Matrix.getHeight(this)},read:function(t,e){return this.isValidAddress(t,e)?this.rows[e][t]:Q.error(`Q.Matrix could not read from cell address (x=${t}, y=${e}) in matrix#${this.index}.`,this)},clone:function(){return new Q.Matrix(...this.rows)},isEqualTo:function(t){return Q.Matrix.areEqual(this,t)},toArray:function(){return this.rows},toXsv:function(t,e){return Q.Matrix.toXsv(this,t,e)},toCsv:function(){return Q.Matrix.toXsv(this,"\n",",")},toTsv:function(){return Q.Matrix.toXsv(this,"\n","\t")},toHtml:function(){return this.rows.reduce(function(t,e){return t+e.reduce(function(t,e){return t+"\n\t\t<td>"+e.toText()+"</td>"},"\n\t<tr>")+"\n\t</tr>"},"\n<table>")+"\n</table>"},write$:function(t,e,i){return this.isValidAddress(t,e)?(i=Q.ComplexNumber.isNumberLike(i)?new Q.ComplexNumber(i):i)instanceof Q.ComplexNumber!=!0?Q.error(`Attempted to write an invalid value (${i}) to matrix#${this.index} at x=${t}, y=`+e,this):(this.rows[e][t]=i,this):Q.error(`Invalid cell address for Matrix#${this.index}: x=${t}, y=`+e,this)},copy$:function(t){if(!0!==Q.Matrix.isMatrixLike(t))return Q.error(`Q.Matrix attempted to copy something that was not a matrix in to this matrix#${t.index}.`,this);if(!0!==Q.Matrix.haveEqualDimensions(t,this))return Q.error(`Q.Matrix cannot copy matrix#${t.index} of dimensions ${t.columns.length}x${t.rows.length} in to this matrix#${this.index} of dimensions ${this.columns.length}x${this.rows.length} because their dimensions do not match.`,this);const r=this;return t.rows.forEach(function(t,i){t.forEach(function(t,e){r.rows[i][e]=t})}),this},fromArray$:function(t){return this.copy$(Q.Matrix.fromArray(t))},fromCsv$:function(t){return this.copy$(Q.Matrix.fromCsv(t))},fromTsv$:function(t){return this.copy$(Q.Matrix.fromTsv(t))},fromHtml$:function(t){return this.copy$(Q.Matrix.fromHtml(t))},add:function(t){return Q.Matrix.add(this,t)},multiplyScalar:function(t){return Q.Matrix.multiplyScalar(this,t)},multiply:function(t){return Q.Matrix.multiply(this,t)},multiplyTensor:function(t){return Q.Matrix.multiplyTensor(this,t)},add$:function(t){return this.copy$(this.add(t))},multiplyScalar$:function(t){return this.copy$(this.multiplyScalar(t))}}),Q.Matrix.createConstants("IDENTITY_2X2",Q.Matrix.createIdentity(2),"IDENTITY_3X3",Q.Matrix.createIdentity(3),"IDENTITY_4X4",Q.Matrix.createIdentity(4),"CONSTANT0_2X2",new Q.Matrix([1,1],[0,0]),"CONSTANT1_2X2",new Q.Matrix([0,0],[1,1]),"NEGATION_2X2",new Q.Matrix([0,1],[1,0]),"TEST_MAP_9X9",new Q.Matrix([11,21,31,41,51,61,71,81,91],[12,22,32,42,52,62,72,82,92],[13,23,33,43,53,63,73,83,93],[14,24,34,44,54,64,74,84,94],[15,25,35,45,55,65,75,85,95],[16,26,36,46,56,66,76,86,96],[17,27,37,47,57,67,77,87,97],[18,28,38,48,58,68,78,88,98],[19,29,39,49,59,69,79,89,99])),Q.Qubit=function(e,i,t,r){if(Q.Matrix.isMatrixLike(e)&&void 0===i?(i=e.rows[1][0],e=e.rows[0][0]):("number"==typeof e&&(e=new Q.ComplexNumber(e,0)),"number"==typeof i&&(i=new Q.ComplexNumber(i,0)),e instanceof Q.ComplexNumber!=!0&&(e=new Q.ComplexNumber(1,0)),i instanceof Q.ComplexNumber!=!0&&(i=Q.ComplexNumber.ONE.subtract(Math.pow(e.absolute(),2)).squareRoot())),Math.pow(e.absolute(),2)+Math.pow(i.absolute(),2)-1>Q.EPSILON)return Q.error(`Q.Qubit could not accept the initialization values of a=${e} and b=${i} because their squares do not add up to 1.`);Q.Matrix.call(this,[e],[i]),this.index=Q.Qubit.index++,Object.defineProperty(this,"alpha",{get:function(){return this.rows[0][0]},set:function(t){this.rows[0][0]=t}}),Object.defineProperty(this,"beta",{get:function(){return this.rows[1][0]},set:function(t){this.rows[1][0]=t}}),"string"==typeof t&&(this.label=t),"string"==typeof r&&(this.name=r),void 0!==this.label&&void 0!==this.name||(void 0===(t=Object.values(Q.Qubit.constants).find(function(t){return e.isEqualTo(t.alpha)&&i.isEqualTo(t.beta)}))?(this.label="?",this.name="Unnamed"):(void 0===this.label&&(this.label=t.label),void 0===this.name&&(this.name=t.name)))},Q.Qubit.prototype=Object.create(Q.Matrix.prototype),Q.Qubit.prototype.constructor=Q.Qubit,Object.assign(Q.Qubit,{index:0,help:function(){return Q.help(this)},constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,findBy:function(e,i){return Object.values(Q.Qubit.constants).find(function(t){return"string"==typeof i&&"string"==typeof t[e]?i.toLowerCase()===t[e].toLowerCase():i===t[e]})},findBySymbol:function(t){return Q.Qubit.findBy("symbol",t)},findByName:function(t){return Q.Qubit.findBy("name",t)},findByBeta:function(e){return e instanceof Q.ComplexNumber==!1&&(e=new Q.ComplexNumber(e)),Object.values(Q.Qubit.constants).find(function(t){return t.beta.isEqualTo(e)})},areEqual:function(t,e){return t.alpha.isEqualTo(e.alpha)&&t.beta.isEqualTo(e.beta)},collapse:function(t){var e=Math.pow(t.alpha.absolute(),2),t=(Math.pow(t.beta.absolute(),2),Math.pow(2,32)-1),i=new Uint32Array(1),i=(window.crypto.getRandomValues(i),i/t);return i<=e?new Q.Qubit(1,0):new Q.Qubit(0,1)},applyGate:function(t,e,...i){return e instanceof Q.Gate==!1?Q.error(`Q.Qubit attempted to apply something that was not a gate to this qubit #${t.index}.`):e.applyToQubit(t,...i)},toText:function(t){return t.alpha.toText()+"\n"+t.beta.toText()},toStateVectorText:function(t){return`|${t.beta.toText()}⟩`},toStateVectorHtml:function(t){return`<span class="Q-state-vector ket">${t.beta.toText()}</span>`},toBlochSphere:function(t){var e=Q.ComplexNumber.arcCosine(t.alpha).multiply(2),t=(isNaN(e.real)&&(e.real=0),isNaN(e.imaginary)&&(e.imaginary=0),Q.ComplexNumber.log(t.beta.divide(Q.ComplexNumber.sine(e.divide(2)))).divide(Q.ComplexNumber.I)),i=(isNaN(t.real)&&(t.real=0),isNaN(t.imaginary)&&(t.imaginary=0),{x:Q.ComplexNumber.sine(e).multiply(Q.ComplexNumber.cosine(t)).real,y:Q.ComplexNumber.sine(e).multiply(Q.ComplexNumber.sine(t)).real,z:Q.ComplexNumber.cosine(e).real});return{theta:e.real,phi:t.real,vector:i,position:{x:i.y,y:i.z,z:i.x}}},fromBlochVector:function(t,e,i){}}),Q.Qubit.createConstants("HORIZONTAL",new Q.Qubit(1,0,"H","Horizontal"),"VERTICAL",new Q.Qubit(0,1,"V","Vertical"),"DIAGONAL",new Q.Qubit(Math.SQRT1_2,Math.SQRT1_2,"D","Diagonal"),"ANTI_DIAGONAL",new Q.Qubit(Math.SQRT1_2,-Math.SQRT1_2,"A","Anti-diagonal"),"RIGHT_HAND_CIRCULAR_POLARIZED",new Q.Qubit(Math.SQRT1_2,new Q.ComplexNumber(0,-Math.SQRT1_2),"R","Right-hand Circular Polarized"),"LEFT_HAND_CIRCULAR_POLARIZED",new Q.Qubit(Math.SQRT1_2,new Q.ComplexNumber(0,Math.SQRT1_2),"L","Left-hand Circular Polarized")),Object.assign(Q.Qubit.prototype,{copy$:function(t){if(!0!==Q.Matrix.isMatrixLike(t))return Q.error(`Q.Qubit attempted to copy something that was not a matrix in this qubit #${qubit.index}.`,this);if(!0!==Q.Matrix.haveEqualDimensions(t,this))return Q.error(`Q.Qubit cannot copy matrix#${t.index} of dimensions ${t.columns.length}x${t.rows.length} in to this qubit #${this.index} of dimensions ${this.columns.length}x${this.rows.length} because their dimensions do not match.`,this);const r=this;return t.rows.forEach(function(t,i){t.forEach(function(t,e){r.rows[i][e]=t})}),this.dirac=t.dirac,this},clone:function(){return new Q.Qubit(this.alpha,this.beta)},isEqualTo:function(t){return Q.Qubit.areEqual(this,t)},collapse:function(){return Q.Qubit.collapse(this)},applyGate:function(t,...e){return Q.Qubit.applyGate(this,t,...e)},toText:function(){return Q.Qubit.toText(this)},toStateVectorText:function(){return Q.Qubit.toStateVectorText(this)},toStateVectorHtml:function(){return Q.Qubit.toStateVectorHtml(this)},toBlochSphere:function(){return Q.Qubit.toBlochSphere(this)},collapse$:function(){return this.copy$(Q.Qubit.collapse(this))},applyGate$:function(t){return this.copy$(Q.Qubit.applyGate(this,t))}}),Q.Gate=function(t){Object.assign(this,t),this.index=Q.Gate.index++,"string"!=typeof this.symbol&&(this.symbol="?"),"string"!=typeof this.symbolAmazonBraket&&(this.symbolAmazonBraket=this.symbol.toLowerCase());const e=this,i=Object.values(Q.Gate.constants).find(function(t){return t.symbol===e.symbol});i&&Q.warn(`Q.Gate is creating a new instance, #${this.index}, that uses the same symbol as a pre-existing Gate constant:`,i),"string"!=typeof this.name&&(this.name="Unknown"),"string"!=typeof this.nameCss&&(this.nameCss="unknown"),"function"==typeof this.updateMatrix$&&this.updateMatrix$(),"function"!=typeof this.applyToQubit&&(this.matrix instanceof Q.Matrix==!0?this.applyToQubit=function(t){return new Q.Qubit(this.matrix.multiply(t))}:this.applyToQubit=function(t){return t})},Object.assign(Q.Gate,{index:0,constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,findBy:function(e,i){return Object.values(Q.Gate.constants).find(function(t){return"string"==typeof i&&"string"==typeof t[e]?i.toLowerCase()===t[e].toLowerCase():i===t[e]})},findBySymbol:function(t){return Q.Gate.findBy("symbol",t)},findByName:function(t){return Q.Gate.findBy("name",t)}}),Object.assign(Q.Gate.prototype,{clone:function(t){return new Q.Gate(Object.assign({},this,t))},applyToQubits:function(){return Array.from(arguments).map(this.applyToQubit.bind(this))},set$:function(t,e){return this[t]=e,this},setSymbol$:function(t){return this.set$("symbol",t)}}),Q.Gate.createConstants("IDENTITY",new Q.Gate({symbol:"I",symbolAmazonBraket:"i",symbolSvg:"",name:"Identity",nameCss:"identity",matrix:Q.Matrix.IDENTITY_2X2}),"CURSOR",new Q.Gate({symbol:"*",symbolAmazonBraket:"i",symbolSvg:"",name:"Identity",nameCss:"identity",matrix:Q.Matrix.IDENTITY_2X2}),"MEASURE",new Q.Gate({symbol:"M",symbolAmazonBraket:"m",symbolSvg:"",name:"Measure",nameCss:"measure",matrix:Q.Matrix.IDENTITY_2X2,applyToQubit:function(t){}}),"HADAMARD",new Q.Gate({symbol:"H",symbolAmazonBraket:"h",symbolSvg:"",name:"Hadamard",nameCss:"hadamard",matrix:new Q.Matrix([Math.SQRT1_2,Math.SQRT1_2],[Math.SQRT1_2,-Math.SQRT1_2])}),"PAULI_X",new Q.Gate({symbol:"X",symbolAmazonBraket:"x",symbolSvg:"",name:"Pauli X",nameCss:"pauli-x",matrix:new Q.Matrix([0,1],[1,0])}),"PAULI_Y",new Q.Gate({symbol:"Y",symbolAmazonBraket:"y",symbolSvg:"",name:"Pauli Y",nameCss:"pauli-y",matrix:new Q.Matrix([0,new Q.ComplexNumber(0,-1)],[new Q.ComplexNumber(0,1),0])}),"PAULI_Z",new Q.Gate({symbol:"Z",symbolAmazonBraket:"z",symbolSvg:"",name:"Pauli Z",nameCss:"pauli-z",matrix:new Q.Matrix([1,0],[0,-1])}),"PHASE",new Q.Gate({symbol:"P",symbolAmazonBraket:"p",symbolSvg:"",name:"Phase",nameCss:"phase",phi:1,updateMatrix$:function(t){return!0===Q.isUsefulNumber(t)&&(this.phi=t),this.matrix=new Q.Matrix([1,0],[0,Q.ComplexNumber.E.power(new Q.ComplexNumber(0,this.phi))]),this},applyToQubit:function(t,e){!0!==Q.isUsefulNumber(e)&&(e=this.phi);e=new Q.Matrix([1,0],[0,Q.ComplexNumber.E.power(new Q.ComplexNumber(0,e))]);return new Q.Qubit(e.multiply(t))}}),"PI_8",new Q.Gate({symbol:"T",symbolAmazonBraket:"t",symbolSvg:"",name:"π ÷ 8",nameCss:"pi8",matrix:new Q.Matrix([1,0],[0,Q.ComplexNumber.E.power(new Q.ComplexNumber(0,Math.PI/4))])}),"BLOCH",new Q.Gate({symbol:"B",symbolSvg:"",name:"Bloch sphere",nameCss:"bloch",applyToQubit:function(t){}}),"SWAP",new Q.Gate({symbol:"S",symbolAmazonBraket:"s",symbolSvg:"",name:"Swap",nameCss:"swap",matrix:new Q.Matrix([1,0,0,0],[0,0,1,0],[0,1,0,0],[0,0,0,1])}),"SWAP1_2",new Q.Gate({symbol:"√S",symbolSvg:"",name:"√Swap",nameCss:"swap1-2",matrix:new Q.Matrix([1,0,0,0],[0,new Q.ComplexNumber(.5,.5),new Q.ComplexNumber(.5,-.5),0],[0,new Q.ComplexNumber(.5,-.5),new Q.ComplexNumber(.5,.5),0],[0,0,0,1])})),Q.History=function(t){this.instance=t,this.entries=[[{redo:{},undo:[{}]}]],this.index=0,this.isRecording=!0},Object.assign(Q.History.prototype,{assess:function(){var t=this.instance;return 0<this.index?window.dispatchEvent(new CustomEvent("Q.History undo is capable",{detail:{instance:t}})):window.dispatchEvent(new CustomEvent("Q.History undo is depleted",{detail:{instance:t}})),this.index+1<this.entries.length?window.dispatchEvent(new CustomEvent("Q.History redo is capable",{detail:{instance:t}})):window.dispatchEvent(new CustomEvent("Q.History redo is depleted",{detail:{instance:t}})),this},createEntry$:function(){this.entries.splice(this.index+1),this.entries.push([]),this.index=this.entries.length-1},record$:function(t){return this.isRecording&&(this.entries[this.index].push(t),this.index=this.entries.length-1,this.assess()),this},step$:function(t){if(t<0&&this.index<1||0<t&&this.index>this.entries.length-2)return!1;this.isRecording=!1;const i=this.instance,r=t<0?"undo":"redo";return 0<t&&this.index++,(0<t?Array.from(this.entries[this.index]):Array.from(this.entries[this.index]).reverse()).reduce(function(t,e,i){return t.concat(e[r])},[]).forEach(function(t,e){"function"==typeof t.func&&t.func.apply(i,t.args)}),t<0&&this.index--,this.isRecording=!0,this.assess(),!0},undo$:function(){return this.step$(-1)},redo$:function(){return this.step$(1)},report:function(){function r(t,e,i){return 0<i&&(t+=",  "),t+("object"==typeof e&&e.name?e.name:e)}return this.entries.reduce(function(t,e,i){return t+="\n\n"+i+" ════════════════════════════════════════"+e.reduce(function(t,e,i){return t+="\n\n    "+i+" ────────────────────────────────────────\n",e.redo&&(t+="\n        ⟳ Redo   ── "+e.redo.name+"  ",e.redo.args)&&(t+=e.redo.args.reduce(r,"")),t+=e.undo.reduce(function(t,e,i){return t+="\n        ⟲ Undo "+i+" ── "+e.name+"  ",e.args&&(t+=e.args.reduce(r,"")),t},"")},"")},"History entry cursor: "+this.index)}}),Q.Circuit=function(t,e){this.index=Q.Circuit.index++,Q.isUsefulInteger(t)||(t=3),this.bandwidth=t,Q.isUsefulInteger(e)||(e=5),this.timewidth=e,this.qubits=new Array(t).fill(Q.Qubit.HORIZONTAL),this.operations=[],this.needsEvaluation=!0,this.results=[],this.matrix=null,this.history=new Q.History(this)},Object.assign(Q.Circuit,{index:0,help:function(){return Q.help(this)},constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,fromText:function(t){return void 0===t?new Q.Circuit:(void 0!==t.raw&&(t=""+t.raw),Q.Circuit.fromTableTransposed(t.trim().split(/\r?\n/).filter(function(t){return t.length}).map(function(t,e){return t.trim().split(/[-+\s+=+]/).filter(function(t){return t.length}).map(function(t,e){t=t.match(/(^\w+)(\.(\w+))*(#(\d+))*/);return{gateSymbol:t[1],operationMomentId:t[3],mappingIndex:+t[5]}})})))},fromText2:function(t){if(void 0===(t=`
			H  C  C
			I  C1 C1
			I  X1 S1
			I  X1 S1`))return new Q.Circuit;(t=void 0!==t.raw?""+t.raw:t).trim().split(/\r?\n/).filter(function(t){return t.length}).map(function(t,e){return t.trim().split(/[-+\s+=+]/).filter(function(t){return t.length}).map(function(t,e){t.match(/(^\w+)(\.(\w+))*(#(\d+))*/)})})},fromTableTransposed:function(n){var t=n.length,e=n.reduce(function(t,e){return Math.max(t,e.length)},0),o=new Q.Circuit(t,e);o.bandwidth=t,o.timewidth=e;for(let r=0;r<t;r++){var a,s,u=r+1;for(let i=0;i<e;i++){const l=i+1,d=n[r][i];let t=!1;for(let e=0;e<r;e++){var c=n[e][i];d.gateSymbol===c.gateSymbol&&d.operationMomentId===c.operationMomentId&&Q.isUsefulInteger(d.mappingIndex)&&Q.isUsefulInteger(c.mappingIndex)&&d.mappingIndex!==c.mappingIndex&&(c=o.operations.findIndex(function(t){return t.momentIndex===l&&t.registerIndices.includes(e+1)}),o.operations[c].registerIndices[d.mappingIndex]=u,o.operations[c].isControlled="*"!=d.gateSymbol,t=!0)}!1===t&&"I"!==d.gateSymbol&&(a=Q.Gate.findBySymbol(d.gateSymbol),s=[],Q.isUsefulInteger(d.mappingIndex)?s[d.mappingIndex]=u:s[0]=u,o.operations.push({gate:a,momentIndex:l,registerIndices:s,isControlled:!1,operationMomentId:d.operationMomentId}))}}return o.sort$(),o},controlled:function(i){var r=i.getWidth(),n=Q.Matrix.createIdentity(2*r);for(let e=0;e<r;e++)for(let t=0;t<r;t++){var o=i.read(e,t);n.write$(e+r,t+r,o)}return n},expandMatrix:function(e,n,o){var i=[],t=Math.pow(2,e);for(let t=0;t<o.length;t++)o[t]=+e-o[t];o.reverse();for(let t=0;t<e;t++)-1==o.indexOf(t)&&i.push(t);var a=new Q.Matrix.createZero(t);let s=t;for(;s--;){let r=t;for(;r--;){let t=!0,e=i.length;for(;e--;)if((s&1<<i[e])!=(r&1<<i[e])){t=!1;break}if(t){let t=0,e=0,i=o.length;for(;i--;){var u=o[i];t|=(s&1<<u)>>u<<i,e|=(r&1<<u)>>u<<i}a.write$(s,r,n.read(t,e))}}}return a},evaluate:function(o){window.dispatchEvent(new CustomEvent("Q.Circuit.evaluate began",{detail:{circuit:o}})),o.sort$();var t=new Q.Matrix(1,Math.pow(2,o.bandwidth));t.write$(0,0,1);const a=o.operations.length;let s=0;var t=o.operations.reduce(function(t,e,i){let r;e.registerIndices.length<1/0&&(e.isControlled,r=e.gate.matrix);for(let t=0;t<e.registerIndices.length-1;t++)r=Q.Circuit.controlled(r);var n=e.registerIndices.slice(),n=(t=Q.Circuit.expandMatrix(o.bandwidth,r,n).multiply(t),++s/a);return window.dispatchEvent(new CustomEvent("Q.Circuit.evaluate progressed",{detail:{circuit:o,progress:n,operationsCompleted:s,operationsTotal:a,momentIndex:e.momentIndex,registerIndices:e.registerIndices,gate:e.gate.name,state:t}})),t},t),e=t.rows.reduce(function(t,e,i){return t.push({state:"|"+parseInt(i,10).toString(2).padStart(o.bandwidth,"0")+"⟩",probability:Math.pow(e[0].absolute(),2)}),t},[]);return o.needsEvaluation=!1,o.matrix=t,o.results=e,window.dispatchEvent(new CustomEvent("Q.Circuit.evaluate completed",{detail:{circuit:o,results:e}})),t}}),Object.assign(Q.Circuit.prototype,{clone:function(){var t=this.copy();return t.qubits=this.qubits.slice(),t.results=this.results.slice(),t.needsEvaluation=this.needsEvaluation,t},evaluate$:function(){return Q.Circuit.evaluate(this),this},report$:function(o){this.needsEvaluation&&this.evaluate$(),Q.isUsefulInteger(o)||(o=20);const a=this,t=this.results.reduce(function(t,e,i){var r=Math.round(e.probability*o),n=o-r;return t+"\n"+(i+1).toString().padStart(Math.ceil(Math.log10(Math.pow(2,a.qubits.length)))," ")+"  "+e.state+"  "+"".padStart(r,"█")+"".padStart(n,"░")+Q.round(Math.round(100*e.probability),8).toString().padStart(4," ")+"% chance"},"")+"\n";return t},try$:function(){this.needsEvaluation&&this.evaluate$();const r=new Array(this.results.length),e=(this.results.reduce(function(t,e,i){return t+=e.probability,r[i]=t},0),Math.random()),t=r.findIndex(function(t){return e<=t});return t},sort$:function(){return this.operations.sort(function(t,e){return t.momentIndex===e.momentIndex?Math.min(...t.registerIndices)-Math.min(e.registerIndices):t.momentIndex-e.momentIndex}),this},toTable:function(){const a=new Array(this.timewidth),n=this;a.timewidth=this.timewidth,a.bandwidth=this.bandwidth,a.fill(0).forEach(function(t,e,i){var r=new Array(n.bandwidth);r.fill(0).forEach(function(t,e,i){i[e]={symbol:"I",symbolDisplay:"I",name:"Identity",nameCss:"identity",gateInputIndex:0,bandwidth:0,thisGateAmongMultiQubitGatesIndex:0,aSiblingIsAbove:!1,aSiblingIsBelow:!1}}),i[e]=r});let e=1,s=0,u={};return this.operations.forEach(function(r,n,t){e!==r.momentIndex&&(a[e].gateTypesUsedThisMoment=u,e=r.momentIndex,s=0,u={}),1<r.registerIndices.length&&(a[e-1].multiRegisterOperationIndex=s,s++),void 0===u[r.gate.symbol]?u[r.gate.symbol]=1:u[r.gate.symbol]++;let o=r.gate.name.toLowerCase().replace(/\s+/g,"-");r.registerIndices.forEach(function(t,e){let i=!1;1<r.registerIndices.length&&(i=!0,o=e===r.registerIndices.length-1?"target":"control"),a[r.momentIndex-1][t-1]={symbol:r.gate.symbol,symbolDisplay:r.gate.symbol,name:r.gate.name,nameCss:o,operationIndex:n,momentIndex:r.momentIndex,registerIndex:t,isMultiRegisterOperation:i,multiRegisterOperationIndex:s,gatesOfThisTypeNow:u[r.gate.symbol],indexAmongSiblings:e,siblingExistsAbove:Math.min(...r.registerIndices)<t,siblingExistsBelow:Math.max(...r.registerIndices)>t}}),a[e-1].gateTypesUsedThisMoment=u}),a.forEach(function(i,t){i.forEach(function(t,e){t.isMultiRegisterOperation&&(1<i.gateTypesUsedThisMoment[t.symbol]&&(t.symbolDisplay=t.symbol+"."+(t.gatesOfThisTypeNow-1)),t.symbolDisplay+="#"+t.indexAmongSiblings)})}),a.forEach(function(t){var e=t.reduce(function(t,e){return Math.max(t,e.symbolDisplay.length)},1);t.maximumCharacterWidth=e}),a.maximumCharacterWidth=a.reduce(function(t,e){return Math.max(t,e.maximumCharacterWidth)},1),a},toText:function(r){var n=this.toTable(),o=new Array(n.bandwidth).fill("");for(let i=0;i<n.timewidth;i++)for(let e=0;e<n.bandwidth;e++){let t=n[i][e].symbolDisplay.padEnd(n[i].maximumCharacterWidth,"-");r&&i<n.timewidth-1&&(t=n[i][e].symbolDisplay.padEnd(n.maximumCharacterWidth,"-")),0<i&&(t="-"+t),o[e]+=t}return"\n"+o.join("\n")},toDiagram:function(t){const a=this.toTable(),s=new Array(3*a.bandwidth+1).fill("");s[0]="        ",this.qubits.forEach(function(t,e){var i=3*e;s[1+i]+="        ",s[2+i]+="r"+(e+1)+"  |"+t.beta.toText().trim()+"⟩─",s[3+i]+="        "});for(let o=0;o<a.timewidth;o++){var u=(t?a:a[o]).maximumCharacterWidth;s[0]+=Q.centerText("m"+(o+1),u+4);for(let n=0;n<a.bandwidth;n++){let t=a[o][n],e="",i="",r="";"I"===t.symbol?(e+="  ",i+="──",r+="  ",e+=" ".padEnd(u),i+=Q.centerText("○",u,"─"),r+=" ".padEnd(u),e+="  ",o<a.timewidth-1?i+="──":i+="  ",r+="  "):(t.isMultiRegisterOperation?(e+="╭─",r+="╰─"):(e+="┌─",r+="└─"),i+="┤ ",e+="─".padEnd(u,"─"),i+=Q.centerText(t.symbolDisplay,u),r+="─".padEnd(u,"─"),t.isMultiRegisterOperation?(e+="─╮",r+="─╯"):(e+="─┐",r+="─┘"),i+=o<a.timewidth-1?" ├":" │",t.isMultiRegisterOperation&&(c=2*t.multiRegisterOperationIndex%(a[o].maximumCharacterWidth+1)+1,t.siblingExistsAbove&&(e=e.substring(0,c)+"┴"+e.substring(1+c)),t.siblingExistsBelow)&&(r=r.substring(0,c)+"┬"+r.substring(1+c)));var c=3*n;s[1+c]+=e,s[2+c]+=i,s[3+c]+=r}}return"\n"+s.join("\n")},toShader:function(){},toGoogleCirq:function(){return headers},toAmazonBraket:function(){let t=this.operations.reduce(function(t,e){let i=void 0!==e.gate.AmazonBraketName?e.gate.AmazonBraketName:e.gate.symbol.substr(0,1).toLowerCase();return"X"===e.gate.symbol&&1<e.registerIndices.length&&(i="cnot"),t+"."+(i="*"===e.gate.symbol?"i":i)+"("+e.registerIndices.reduce(function(t,e,i){return t+(0<i?",":"")+(e-1)},"")+")"},"qjs_circuit = Circuit()");0===this.operations.length&&(t+=".i(0)");return`import boto3
from braket.aws import AwsQuantumSimulator, AwsQuantumSimulatorArns
from braket.circuits import Circuit

aws_account_id = boto3.client("sts").get_caller_identity()["Account"]
device = AwsQuantumSimulator(AwsQuantumSimulatorArns.QS1)
s3_folder = (f"braket-output-{aws_account_id}", "folder-name")

`+t+`

task = device.run(qjs_circuit, s3_folder, shots=100)
print(task.result().measurement_counts)`},toLatex:function(){return"\\Qcircuit @C=1.0em @R=0.7em {\n"+this.toTable().reduce(function(i,t,e){t.forEach(function(t,e,i){let r="qw";"I"!==t.symbol&&(t.isMultiRegisterOperation?0===t.indexAmongSiblings?r="X"===t.symbol?"targ":t.symbol.toLowerCase():0<t.indexAmongSiblings&&(r="ctrl{?}"):r=t.symbol.toLowerCase()),i[e].latexCommand=r});const r=t.reduce(function(t,e){return Math.max(t,e.latexCommand.length)},0);return t.forEach(function(t,e){i[e]+="& \\"+t.latexCommand.padEnd(r)+"  "}),i},new Array(this.bandwidth).fill("\n\t")).join("\\\\")+"\n}"},get:function(e,i){return this.operations.find(function(t){return t.momentIndex===e&&t.registerIndices.includes(i)})},clear$:function(r,n){const i=this;var t;return 2!==arguments.length&&Q.warn(`Q.Circuit.clear$ expected 2 arguments but received ${arguments.length}.`),!0!==Q.isUsefulInteger(r)?Q.error(`Q.Circuit attempted to clear an input on Circuit #${i.index} using an invalid moment index:`,r):(n=Q.isUsefulInteger(n)?[n]:n)instanceof Array!=!0?Q.error(`Q.Circuit attempted to clear an input on Circuit #${i.index} using an invalid register indices array:`,n):((t=i.operations.reduce(function(t,e,i){return e.momentIndex===r&&e.registerIndices.some(function(t){return n.includes(t)})&&t.push({index:i,momentIndex:e.momentIndex,registerIndices:e.registerIndices,gate:e.gate}),t},[])).reduce(function(t,e){return i.operations.splice(e.index-t,1),t+1},0),this.sort$(),t.length&&(this.history.record$({redo:{name:"clear$",func:i.clear$,args:Array.from(arguments)},undo:t.reduce(function(t,e){return t.push({name:"set$",func:i.set$,args:[e.gate,e.momentIndex,e.registerIndices]}),t},[])}),t.forEach(function(t){window.dispatchEvent(new CustomEvent("Q.Circuit.clear$",{detail:{circuit:i,momentIndex:r,registerIndices:t.registerIndices}}))})),i)},setProperty$:function(t,e){return this[t]=e,this},setName$:function(t){return"function"==typeof t&&(t=t()),this.setProperty$("name",t)},set$:function(t,i,r){const n=this;var e;return(t="string"==typeof t?Q.Gate.findBySymbol(t):t)instanceof Q.Gate!=!0?Q.error(`Q.Circuit attempted to add a gate to circuit #${this.index} at moment #${i} that is not a gate:`,t):!0!==Q.isUsefulNumber(i)||!0!==Number.isInteger(i)||i<1||i>this.timewidth?Q.error(`Q.Circuit attempted to add a gate to circuit #${this.index} at a moment index that is not valid:`,i):(r="number"==typeof r?[r]:r)instanceof Array!=!0?Q.error(`Q.Circuit attempted to add a gate to circuit #${this.index} at moment #${i} with an invalid register indices array:`,r):0===r.length?Q.error(`Q.Circuit attempted to add a gate to circuit #${this.index} at moment #${i} with an empty register indices array:`,r):r.reduce(function(t,e){return t&&0<e&&e<=n.bandwidth},!1)?Q.warn(`Q.Circuit attempted to add a gate to circuit #${this.index} at moment #${i} with some out of range qubit indices:`,r):(!0!=!!n.operations.find(function(e){return i===e.momentIndex&&t===e.gate&&r.length===e.registerIndices.length&&r.every(t=>e.registerIndices.includes(t))})&&(this.clear$(i,r),e=1<r.length&&t!==Q.Gate.SWAP,e={gate:t,momentIndex:i,registerIndices:r,isControlled:e},this.operations.push(e),this.sort$(),this.history.record$({redo:{name:"set$",func:n.set$,args:Array.from(arguments)},undo:[{name:"clear$",func:n.clear$,args:[i,r]}]}),window.dispatchEvent(new CustomEvent("Q.Circuit.set$",{detail:{circuit:n,operation:e}}))),n)},determineRanges:function(t){let{qubitFirstIndex:e,qubitRange:i,qubitLastIndex:r,momentFirstIndex:n,momentRange:o,momentLastIndex:a}=t=void 0===t?{}:t;if("number"!=typeof e&&(e=0),"number"!=typeof(r="number"!=typeof r&&"number"!=typeof i?this.bandwidth:r)&&"number"==typeof i)r=e+i;else{if("number"!=typeof r||"number"==typeof i)return Q.error("Q.Circuit attempted to copy a circuit but could not understand what qubits to copy.");i=r-e}if("number"!=typeof n&&(n=0),"number"!=typeof(a="number"!=typeof a&&"number"!=typeof o?this.timewidth:a)&&"number"==typeof o)a=n+o;else{if("number"!=typeof a||"number"==typeof o)return Q.error("Q.Circuit attempted to copy a circuit but could not understand what moments to copy.");o=a-n}return Q.log(.8,"\nQ.Circuit copy operation:","\n\n  qubitFirstIndex",e,"\n  qubitLastIndex ",r,"\n  qubitRange     ",i,"\n\n  momentFirstIndex",n,"\n  momentLastIndex ",a,"\n  momentRange     ",o,"\n\n"),{qubitFirstIndex:e,qubitRange:i,qubitLastIndex:r,momentFirstIndex:n,momentRange:o,momentLastIndex:a}},copy:function(t,e){let{registerFirstIndex:i,registerRange:r,registerLastIndex:n,momentFirstIndex:o,momentRange:a,momentLastIndex:s}=this.determineRanges(t);const u=new Q.Circuit(r,a);return this.operations.filter(function(e){return e.registerIndices.every(function(t){return e.momentIndex>=o&&e.momentIndex<s&&e.registerIndex>=i&&e.registerIndex<n})}).forEach(function(t){var e=t.registerIndices.map(function(t){return t-i});u.set$(t.gate,1+m-o,e)}),u},cut$:function(t){return this.copy(t,!0)},spliceCut$:function(t){let{qubitFirstIndex:i,qubitRange:e,qubitLastIndex:r,momentFirstIndex:n,momentRange:o,momentLastIndex:a}=this.determineRanges(t);return e!==this.bandwidth&&o!==this.timewidth?Q.error(`Q.Circuit attempted to splice circuit #${this.index} by an area that did not include all qubits _or_ all moments.`):(e===this.bandwidth&&(this.moments=this.moments.reduce(function(t,e,i){return(i<n-1||i>=a-1)&&t.push(e),t},[]),this.timewidth-=o),o===this.timewidth&&(this.inputs.splice(i,e),this.moments=this.moments.map(function(t){return t.reduce(function(t,e){return e.qubitIndices.every(function(t){return t<i||t>=r})&&t.push(e),t},[]).map(function(t){return t.qubitIndices=t.qubitIndices.map(function(t){return t>=r?t-e:t}),t})}),this.bandwidth-=e),this.removeHangingOperations$(),this.fillEmptyOperations$(),this)},splicePaste$:function(){},paste$:function(t,i=0,r=0,e=!0){const n=this;return this.timewidth=Math.max(this.timewidth,i+t.timewidth),this.bandwidth=Math.max(this.bandwidth,r+t.bandwidth),this.ensureMomentsAreReady$(),this.fillEmptyOperations$(),t.moments.forEach(function(t,e){t.forEach(function(t){n.set$(t.gate,e+i+1,t.qubitIndices.map(function(t){return t+r}))})}),e&&this.removeHangingOperations$(),this.fillEmptyOperations$(),this},pasteInsert$:function(t,e,i){return shouldClean&&this.removeHangingOperations$(),this.fillEmptyOperations$(),this},expand$:function(){return this.fillEmptyOperations$(),thiis},trim$:function(t){var{qubitFirstIndex:t,qubitRange:e,qubitLastIndex:i,momentFirstIndex:r,momentRange:n,momentLastIndex:o}=this.determineRanges(t);return this.moments=this.moments.slice(r,o),this.timewidth=n,this.inputs=this.inputs.slice(t,i),this.bandwidth=e,this.removeHangingOperations$(),this.fillEmptyOperations$(),this}}),Object.entries(Q.Gate.constants).forEach(function(t){function e(t,e){return this.set$(r,t,e),this}const i=t[0],r=t[1];Q.Circuit.prototype[i]=e,Q.Circuit.prototype[r.symbol]=e,Q.Circuit.prototype[r.symbol.toLowerCase()]=e}),Q.Circuit.createConstants("BELL",Q`

		H  X#0
		I  X#1
	`),Q.Circuit.Editor=function(e,t){e instanceof Q.Circuit!=!0&&(e=new Q.Circuit),this.circuit=e,this.index=Q.Circuit.Editor.index++;function r(){return document.createElement("div")}this.name="string"==typeof e.name?e.name:"Q Editor "+this.index;const n=(t="string"==typeof t?document.getElementById(t):t)instanceof HTMLElement?t:r();if(n.classList.add("Q-circuit"),"string"==typeof n.getAttribute("id"))this.domId=n.getAttribute("id");else{let t=this.name.replace(/^[^a-z]+|[^\w:.-]+/gi,"-"),e=t,i=1;for(;null!==document.getElementById(e);)i++,e=t+"-"+i;this.domId=e,n.setAttribute("id",this.domId)}n.circuit=e,this.domElement=n;var t=r(),i=(n.appendChild(t),t.classList.add("Q-circuit-toolbar"),r());t.appendChild(i),i.classList.add("Q-circuit-button","Q-circuit-toggle","Q-circuit-toggle-lock"),i.setAttribute("title","Lock / unlock"),i.innerText="🔓";const o=r(),a=(t.appendChild(o),o.classList.add("Q-circuit-button","Q-circuit-button-undo"),o.setAttribute("title","Undo"),o.setAttribute("Q-disabled","Q-disabled"),o.innerHTML="⟲",window.addEventListener("Q.History undo is depleted",function(t){t.detail.instance===e&&o.setAttribute("Q-disabled","Q-disabled")}),window.addEventListener("Q.History undo is capable",function(t){t.detail.instance===e&&o.removeAttribute("Q-disabled")}),r());t.appendChild(a),a.classList.add("Q-circuit-button","Q-circuit-button-redo"),a.setAttribute("title","Redo"),a.setAttribute("Q-disabled","Q-disabled"),a.innerHTML="⟳",window.addEventListener("Q.History redo is depleted",function(t){t.detail.instance===e&&a.setAttribute("Q-disabled","Q-disabled")}),window.addEventListener("Q.History redo is capable",function(t){t.detail.instance===e&&a.removeAttribute("Q-disabled")});var i=r(),i=(t.appendChild(i),i.classList.add("Q-circuit-button","Q-circuit-toggle","Q-circuit-toggle-control"),i.setAttribute("title","Create controlled operation"),i.setAttribute("Q-disabled","Q-disabled"),i.innerText="C",r()),t=(t.appendChild(i),i.classList.add("Q-circuit-button","Q-circuit-toggle-swap"),i.setAttribute("title","Create swap operation"),i.setAttribute("Q-disabled","Q-disabled"),i.innerText="S",r()),i=(n.appendChild(t),t.classList.add("Q-circuit-board-container"),t.addEventListener("mouseleave",function(){Q.Circuit.Editor.unhighlightAll(n)}),r()),s=(t.appendChild(i),i.classList.add("Q-circuit-board"),r());i.appendChild(s),s.classList.add("Q-circuit-board-background");for(let t=0;t<e.bandwidth;t++){var u=r(),c=(s.appendChild(u),u.style.position="relative",u.style.gridRowStart=t+2,u.style.gridColumnStart=1,u.style.gridColumnEnd=Q.Circuit.Editor.momentIndexToGridColumn(e.timewidth)+1,u.setAttribute("register-index",t+1),r());u.appendChild(c),c.classList.add("Q-circuit-register-wire")}for(let t=0;t<e.timewidth;t++){var l=r();s.appendChild(l),l.style.gridRowStart=2,l.style.gridRowEnd=Q.Circuit.Editor.registerIndexToGridRow(e.bandwidth)+1,l.style.gridColumnStart=t+3,l.setAttribute("moment-index",t+1)}const d=r();i.appendChild(d),d.classList.add("Q-circuit-board-foreground");t=r();d.appendChild(t),t.classList.add("Q-circuit-header","Q-circuit-selectall"),t.setAttribute("title","Select all"),t.setAttribute("moment-index","0"),t.setAttribute("register-index","0"),t.innerHTML="&searr;";for(let t=0;t<e.bandwidth;t++){var m=t+1,h=r();d.appendChild(h),h.classList.add("Q-circuit-header","Q-circuit-register-label"),h.setAttribute("title","Register "+m+" of "+e.bandwidth),h.setAttribute("register-index",m),h.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(m),h.innerText=m}i=r();d.appendChild(i),i.classList.add("Q-circuit-header","Q-circuit-register-add"),i.setAttribute("title","Add register"),i.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(e.bandwidth+1),i.innerText="+";for(let t=0;t<e.timewidth;t++){var g=t+1,p=r();d.appendChild(p),p.classList.add("Q-circuit-header","Q-circuit-moment-label"),p.setAttribute("title","Moment "+g+" of "+e.timewidth),p.setAttribute("moment-index",g),p.style.gridColumnStart=Q.Circuit.Editor.momentIndexToGridColumn(g),p.innerText=g}t=r(),d.appendChild(t),t.classList.add("Q-circuit-header","Q-circuit-moment-add"),t.setAttribute("title","Add moment"),t.style.gridColumnStart=Q.Circuit.Editor.momentIndexToGridColumn(e.timewidth+1),t.innerText="+",e.qubits.forEach(function(t,e){var e=e+1,i=r();i.classList.add("Q-circuit-header","Q-circuit-input"),i.setAttribute("title",`Qubit #${e} starting value`),i.setAttribute("register-index",e),i.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(e),i.innerText=t.beta.toText(),d.appendChild(i)}),e.operations.forEach(function(t){Q.Circuit.Editor.set(n,t)}),n.addEventListener("mousedown",Q.Circuit.Editor.onPointerPress),n.addEventListener("touchstart",Q.Circuit.Editor.onPointerPress),window.addEventListener("Q.Circuit.set$",Q.Circuit.Editor.prototype.onExternalSet.bind(this)),window.addEventListener("Q.Circuit.clear$",Q.Circuit.Editor.prototype.onExternalClear.bind(this)),i=document.createElement("p");n.appendChild(i),i.innerHTML=`
		This circuit is accessible in your 
		<a href="https://quantumjavascript.app/#Open_your_JavaScript_console" target="_blank">JavaScript console</a>
		as <code>document.getElementById('${this.domId}').circuit</code>`,Q.log(.5,`

Created a DOM interface for $('#${this.domId}').circuit

`,e.toDiagram(),"\n\n\n")},Q.Circuit.toDom=function(t,e){return new Q.Circuit.Editor(t,e).domElement},Q.Circuit.prototype.toDom=function(t){return new Q.Circuit.Editor(this,t).domElement},Object.assign(Q.Circuit.Editor,{index:0,help:function(){return Q.help(this)},dragEl:null,gridColumnToMomentIndex:function(t){return+t-2},momentIndexToGridColumn:function(t){return t+2},gridRowToRegisterIndex:function(t){return+t-1},registerIndexToGridRow:function(t){return t+1},gridSize:4,pointToGrid:function(t){var e=parseFloat(getComputedStyle(document.documentElement).fontSize);return 1+Math.floor(t/(e*Q.Circuit.Editor.gridSize))},gridToPoint:function(t){return parseFloat(getComputedStyle(document.documentElement).fontSize)*Q.Circuit.Editor.gridSize*(t-1)},getInteractionCoordinates:function(t,e){return"string"!=typeof e&&(e="client"),t.changedTouches&&t.changedTouches.length?{x:t.changedTouches[0][e+"X"],y:t.changedTouches[0][e+"Y"]}:{x:t[e+"X"],y:t[e+"Y"]}},createPalette:function(t){function n(t,e){return e=t+Math.random()*(e-t),Math.floor(2*Math.random())?e:-e}const o=(t="string"==typeof t?document.getElementById(t):t)instanceof HTMLElement?t:document.createElement("div");return o.classList.add("Q-circuit-palette"),"HXYZPT*".split("").forEach(function(t){var e=Q.Gate.findBySymbol(t),i=document.createElement("div");o.appendChild(i),i.classList.add("Q-circuit-operation"),i.classList.add("Q-circuit-operation-"+e.nameCss),i.setAttribute("gate-symbol",t),i.setAttribute("title",e.name);const r=document.createElement("div");i.appendChild(r),r.classList.add("Q-circuit-operation-tile"),t!==Q.Gate.CURSOR.symbol&&(r.innerText=t),["before","after"].forEach(function(t){r.style.setProperty("--Q-"+t+"-rotation",n(.5,4)+"deg"),r.style.setProperty("--Q-"+t+"-x",n(1,4)+"px"),r.style.setProperty("--Q-"+t+"-y",n(1,3)+"px")})}),o.addEventListener("mousedown",Q.Circuit.Editor.onPointerPress),o.addEventListener("touchstart",Q.Circuit.Editor.onPointerPress),o}}),Q.Circuit.Editor.prototype.onExternalClear=function(t){t.detail.circuit===this.circuit&&Q.Circuit.Editor.clear(this.domElement,{momentIndex:t.detail.momentIndex,registerIndices:t.detail.registerIndices})},Q.Circuit.Editor.clear=function(e,t){const i=t.momentIndex;t.registerIndices.forEach(function(t){Array.from(e.querySelectorAll(`[moment-index="${i}"]`+`[register-index="${t}"]`)).forEach(function(t){t.parentNode.removeChild(t)})})},Q.Circuit.Editor.prototype.onExternalSet=function(t){t.detail.circuit===this.circuit&&Q.Circuit.Editor.set(this.domElement,t.detail.operation)},Q.Circuit.Editor.set=function(t,a){const s=t.querySelector(".Q-circuit-board-background"),n=t.querySelector(".Q-circuit-board-foreground");t.circuit,t.circuit.operations.indexOf(a);a.registerIndices.forEach(function(e,t){var i=document.createElement("div"),r=(n.appendChild(i),i.classList.add("Q-circuit-operation","Q-circuit-operation-"+a.gate.nameCss),i.setAttribute("gate-symbol",a.gate.symbol),i.setAttribute("gate-index",a.gate.index),i.setAttribute("moment-index",a.momentIndex),i.setAttribute("register-index",e),i.setAttribute("register-array-index",t),i.setAttribute("is-controlled",a.isControlled),i.setAttribute("title",a.gate.name),i.style.gridColumnStart=Q.Circuit.Editor.momentIndexToGridColumn(a.momentIndex),i.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(e),document.createElement("div"));i.appendChild(r),r.classList.add("Q-circuit-operation-tile"),a.gate.symbol!==Q.Gate.CURSOR.symbol&&(r.innerText=a.gate.symbol),1<a.registerIndices.length&&(i.setAttribute("register-indices",a.registerIndices),i.setAttribute("register-indices-index",t),i.setAttribute("sibling-indices",a.registerIndices.filter(function(t){return e!==t})),a.registerIndices.forEach(function(t,e){var i,r,n,o;e<a.registerIndices.length-1&&(e=a.registerIndices[e+1],i=Math.abs(e-t),r=Math.min(t,e),e=Math.max(t,e),n=document.createElement("div"),o=document.createElement("div"),s.appendChild(n),n.setAttribute("moment-index",a.momentIndex),n.setAttribute("register-index",t),n.classList.add("Q-circuit-operation-link-container"),n.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(r),n.style.gridRowEnd=Q.Circuit.Editor.registerIndexToGridRow(e+1),n.style.gridColumn=Q.Circuit.Editor.momentIndexToGridColumn(a.momentIndex),n.appendChild(o),o.classList.add("Q-circuit-operation-link"),1<i)&&o.classList.add("Q-circuit-operation-link-curved")}),a.isControlled&&0===t?(i.classList.add("Q-circuit-operation-control"),i.setAttribute("title","Control"),r.innerText=""):i.classList.add("Q-circuit-operation-target"))})},Q.Circuit.Editor.isValidControlCandidate=function(t){const n=Array.from(t.querySelectorAll(".Q-circuit-cell-selected"));var e,i;return!(n.length<2||(t=n.reduce(function(t,e){return t[e.getAttribute("moment-index")]=!0,t},{}),1<Object.keys(t).length)||!0!==n.reduce(function(t,e){const i=e.getAttribute("register-indices");var r;return i?(e=i.split(",").map(function(t){return+t}).length,r=n.reduce(function(t,e){return e.getAttribute("register-indices")===i&&t.push(e),t},[]).length,t&&r===e):t},!0))&&(t=n.reduce(function(t,e){e=e.getAttribute("gate-symbol");return Q.isUsefulInteger(t[e])?t[e]++:t[e]=1,t},{}),{totalControlled:e,totalNotControlled:i}=n.reduce(function(t,e){return"true"===e.getAttribute("is-controlled")?t.totalControlled++:t.totalNotControlled++,t},{totalControlled:0,totalNotControlled:0}),1===t[Q.Gate.CURSOR.symbol]&&2===Object.keys(t).length&&i===n.length||void 0===t[Q.Gate.CURSOR.symbol]&&1===Object.keys(t).length&&0<e&&0<i)},Q.Circuit.Editor.createControl=function(t){if(!0===Q.Circuit.Editor.isValidControlCandidate(t)){const e=t.circuit,i=Array.from(t.querySelectorAll(".Q-circuit-cell-selected")),r=i.find(function(t){return"true"===t.getAttribute("is-controlled")&&"0"===t.getAttribute("register-array-index")}),n=r||i.find(function(t){return t.getAttribute("gate-symbol")===Q.Gate.CURSOR.symbol}),o=i.reduce(function(t,e){return e!==n&&t.push(e),t},[]);e.history.createEntry$(),i.forEach(function(t){e.clear$(+t.getAttribute("moment-index"),+t.getAttribute("register-index"))}),e.set$(o[0].getAttribute("gate-symbol"),+n.getAttribute("moment-index"),[+n.getAttribute("register-index")].concat(o.reduce(function(t,e){return t.push(+e.getAttribute("register-index")),t},[]))),Q.Circuit.Editor.onSelectionChanged(t),Q.Circuit.Editor.onCircuitChanged(t)}return this},Q.Circuit.Editor.isValidSwapCandidate=function(t){t=Array.from(t.querySelectorAll(".Q-circuit-cell-selected"));return 2===t.length&&!!(areBothCursors=t.every(function(t){return t.getAttribute("gate-symbol")===Q.Gate.CURSOR.symbol}))},Q.Circuit.Editor.createSwap=function(t){var e,i;return!0===Q.Circuit.Editor.isValidSwapCandidate(t)&&(i=+(e=Array.from(t.querySelectorAll(".Q-circuit-cell-selected")))[0].getAttribute("moment-index"),registerIndices=e.reduce(function(t,e){return t.push(+e.getAttribute("register-index")),t},[]),(circuit=t.circuit).history.createEntry$(),e.forEach(function(t){circuit.clear$(+t.getAttribute("moment-index"),+t.getAttribute("register-index"))}),circuit.set$(Q.Gate.SWAP,i,registerIndices),Q.Circuit.Editor.onSelectionChanged(t),Q.Circuit.Editor.onCircuitChanged(t)),this},Q.Circuit.Editor.onSelectionChanged=function(t){var e=t.querySelector(".Q-circuit-toggle-control"),e=(Q.Circuit.Editor.isValidControlCandidate(t)?e.removeAttribute("Q-disabled"):e.setAttribute("Q-disabled",!0),t.querySelector(".Q-circuit-toggle-swap"));Q.Circuit.Editor.isValidSwapCandidate(t)?e.removeAttribute("Q-disabled"):e.setAttribute("Q-disabled",!0)},Q.Circuit.Editor.onCircuitChanged=function(t){t=t.circuit;window.dispatchEvent(new CustomEvent("Q gui altered circuit",{detail:{circuit:t}}))},Q.Circuit.Editor.unhighlightAll=function(t){Array.from(t.querySelectorAll(".Q-circuit-board-background > div,.Q-circuit-board-foreground > div")).forEach(function(t){t.classList.remove("Q-circuit-cell-highlighted")})},Q.Circuit.Editor.onPointerMove=function(t){const{x:e,y:i}=Q.Circuit.Editor.getInteractionCoordinates(t),r=document.elementsFromPoint(e,i),n=r.find(function(t){return t.classList.contains("Q-circuit-board-container")});if(null!==Q.Circuit.Editor.dragEl&&(t.preventDefault(),Q.Circuit.Editor.dragEl.style.left=e+window.pageXOffset+Q.Circuit.Editor.dragEl.offsetX+"px",Q.Circuit.Editor.dragEl.style.top=i+window.pageYOffset+Q.Circuit.Editor.dragEl.offsetY+"px",!n&&Q.Circuit.Editor.dragEl.circuitEl?Q.Circuit.Editor.dragEl.classList.add("Q-circuit-clipboard-danger"):Q.Circuit.Editor.dragEl.classList.remove("Q-circuit-clipboard-danger")),n){t=n.closest(".Q-circuit");if(!t.classList.contains("Q-circuit-locked")){Array.from(n.querySelectorAll(`

		.Q-circuit-board-background > div, 
		.Q-circuit-board-foreground > div
	
	`)).forEach(function(t){t.classList.remove("Q-circuit-cell-highlighted")});function o(t){Array.from(n.querySelectorAll(t)).forEach(function(t){t.classList.add("Q-circuit-cell-highlighted")})}var a=r.find(function(t){return"sticky"===window.getComputedStyle(t).position&&(null!==t.getAttribute("moment-index")||null!==t.getAttribute("register-index"))});if(a){const m=a.getAttribute("moment-index"),h=a.getAttribute("register-index");return null===m?void o(`div[register-index="${h}"]`):null===h?void o(`div[moment-index="${m}"]`):void o(`

			.Q-circuit-board-background > div[moment-index],
			.Q-circuit-board-foreground > .Q-circuit-operation

		`)}const s=n.getBoundingClientRect(),u=e-s.left+n.scrollLeft+1,c=i-s.top+n.scrollTop+1,l=Q.Circuit.Editor.pointToGrid(u),d=Q.Circuit.Editor.pointToGrid(c),m=Q.Circuit.Editor.gridColumnToMomentIndex(l),h=Q.Circuit.Editor.gridRowToRegisterIndex(d);m>t.circuit.timewidth||h>t.circuit.bandwidth||m<1||h<1||o(`

		div[moment-index="${m}"],
		div[register-index="${h}"]
	`)}}},Q.Circuit.Editor.onPointerPress=function(t){if(null!==Q.Circuit.Editor.dragEl)Q.Circuit.Editor.onPointerRelease(t);else{const m=t.target,h=m.closest(".Q-circuit"),o=m.closest(".Q-circuit-palette");if(h||o){(dragEl=document.createElement("div")).classList.add("Q-circuit-clipboard");const{x:g,y:p}=Q.Circuit.Editor.getInteractionCoordinates(t);if(h){var e=h.circuit,i=h.classList.contains("Q-circuit-locked"),r=m.closest(".Q-circuit-toggle-lock");if(r)return i?(h.classList.remove("Q-circuit-locked"),r.innerText="🔓"):(h.classList.add("Q-circuit-locked"),r.innerText="🔒",Q.Circuit.Editor.unhighlightAll(h)),t.preventDefault(),void t.stopPropagation();if(i)return void Q.warn("User attempted to interact with a circuit editor but it was locked.");var r=m.closest(`

			.Q-circuit-board-foreground > div,
			.Q-circuit-palette > div
		`),i=m.closest(".Q-circuit-button-undo"),n=m.closest(".Q-circuit-button-redo"),s=m.closest(".Q-circuit-toggle-control"),u=m.closest(".Q-circuit-toggle-swap"),c=m.closest(".Q-circuit-moment-add"),l=m.closest(".Q-circuit-register-add");if(!(r||i||n||s||u||c||l))return;if(t.preventDefault(),t.stopPropagation(),i&&e.history.undo$()&&(Q.Circuit.Editor.onSelectionChanged(h),Q.Circuit.Editor.onCircuitChanged(h)),n&&e.history.redo$()&&(Q.Circuit.Editor.onSelectionChanged(h),Q.Circuit.Editor.onCircuitChanged(h)),s&&Q.Circuit.Editor.createControl(h),u&&Q.Circuit.Editor.createSwap(h),c&&console.log("→ Add moment"),l&&console.log("→ Add register"),!r)return;const f=+r.getAttribute("moment-index"),b=+r.getAttribute("register-index"),x=Q.Circuit.Editor.momentIndexToGridColumn(f),C=Q.Circuit.Editor.registerIndexToGridRow(b);i=m.closest(".Q-circuit-selectall"),n=m.closest(".Q-circuit-register-label"),e=m.closest(".Q-circuit-moment-label"),s=m.closest(".Q-circuit-input"),u=m.closest(".Q-circuit-operation");if(s)return void console.log("→ Edit input Qubit value at",b);function d(t){t=Array.from(h.querySelectorAll(t));t.reduce(function(t,e){return t+=+e.classList.contains("Q-circuit-cell-selected")},0)===t.length?t.forEach(function(t){t.classList.remove("Q-circuit-cell-selected")}):t.forEach(function(t){t.classList.add("Q-circuit-cell-selected")}),Q.Circuit.Editor.onSelectionChanged(h)}if(i)return void d(".Q-circuit-operation");if(e)return void d(`.Q-circuit-operation[moment-index="${f}"]`);if(n)return void d(`.Q-circuit-operation[register-index="${b}"]`);if(!u)return;u.classList.contains("Q-circuit-cell-selected")?u.wasSelected=!0:u.wasSelected=!1,u.classList.add("Q-circuit-cell-selected");c=Array.from(h.querySelectorAll(".Q-circuit-cell-selected"));dragEl.circuitEl=h,dragEl.originEl=h.querySelector(".Q-circuit-board-foreground"),dragEl.columnIndexOffset=1;let o=(dragEl.rowIndexOffset=1)/0,a=1/0;c.forEach(function(t){var e=+t.getAttribute("moment-index"),i=+t.getAttribute("register-index"),r=Q.Circuit.Editor.momentIndexToGridColumn(e),n=Q.Circuit.Editor.registerIndexToGridRow(i);o=Math.min(o,r),a=Math.min(a,n),t.classList.remove("Q-circuit-cell-selected"),t.origin={momentIndex:e,registerIndex:i,columnIndex:r,rowIndex:n},dragEl.appendChild(t)}),c.forEach(function(t){var e=1+t.origin.columnIndex-o,i=1+t.origin.rowIndex-a;t.style.gridColumn=e,t.style.gridRow=i,t.origin.columnIndex===x&&t.origin.rowIndex===C&&(dragEl.columnIndexOffset=e,dragEl.rowIndexOffset=i)});l=h.querySelector(".Q-circuit-board-foreground").getBoundingClientRect(),r=Q.Circuit.Editor.gridToPoint(o),s=Q.Circuit.Editor.gridToPoint(a);dragEl.offsetX=l.left+r-g,dragEl.offsetY=l.top+s-p,dragEl.momentIndex=f,dragEl.registerIndex=b}else if(o){i=m.closest(".Q-circuit-operation");if(!i)return;const a=i.getBoundingClientRect(),{x:g,y:p}=Q.Circuit.Editor.getInteractionCoordinates(t);dragEl.appendChild(i.cloneNode(!0)),dragEl.originEl=o,dragEl.offsetX=a.left-g,dragEl.offsetY=a.top-p}dragEl.timestamp=Date.now(),document.body.appendChild(dragEl),Q.Circuit.Editor.dragEl=dragEl,Q.Circuit.Editor.onPointerMove(t)}}},Q.Circuit.Editor.onPointerRelease=function(t){if(null!==Q.Circuit.Editor.dragEl){t.preventDefault(),t.stopPropagation();function e(){Q.Circuit.Editor.dragEl.circuitEl&&(Array.from(Q.Circuit.Editor.dragEl.children).forEach(function(t){Q.Circuit.Editor.dragEl.originEl.appendChild(t),t.style.gridColumn=t.origin.columnIndex,t.style.gridRow=t.origin.rowIndex,!0===t.wasSelected?t.classList.remove("Q-circuit-cell-selected"):t.classList.add("Q-circuit-cell-selected")}),Q.Circuit.Editor.onSelectionChanged(Q.Circuit.Editor.dragEl.circuitEl)),document.body.removeChild(Q.Circuit.Editor.dragEl),Q.Circuit.Editor.dragEl=null}var{x:t,y:i}=Q.Circuit.Editor.getInteractionCoordinates(t),r=document.elementsFromPoint(t,i).find(function(t){return t.classList.contains("Q-circuit-board-container")});if(r){const p=r.closest(".Q-circuit");if(p.classList.contains("Q-circuit-locked"))e();else{const n=p.circuit,o=r.getBoundingClientRect(),a=t-o.left+r.scrollLeft,s=i-o.top+r.scrollTop,f=Q.Circuit.Editor.gridColumnToMomentIndex(Q.Circuit.Editor.pointToGrid(a)),b=Q.Circuit.Editor.gridRowToRegisterIndex(Q.Circuit.Editor.pointToGrid(s));p.querySelector(".Q-circuit-board-foreground");if(Q.Circuit.Editor.dragEl.circuitEl===p&&Q.Circuit.Editor.dragEl.momentIndex===f&&Q.Circuit.Editor.dragEl.registerIndex===b)e();else if(f<1||f>n.timewidth||b<1||b>n.bandwidth)e();else{const x=Array.from(Q.Circuit.Editor.dragEl.children),C=f-Q.Circuit.Editor.dragEl.momentIndex,y=b-Q.Circuit.Editor.dragEl.registerIndex,w=[];n.history.createEntry$(),x.forEach(function(e,i){let r=f,n=b;Q.Circuit.Editor.dragEl.circuitEl&&(r+=e.origin.momentIndex-Q.Circuit.Editor.dragEl.momentIndex,n+=e.origin.registerIndex-Q.Circuit.Editor.dragEl.registerIndex);var o=e.getAttribute("register-indices");if(o){const u=o.split(",").map(function(t){return+t}),c=Array.from(Q.Circuit.Editor.dragEl.querySelectorAll(`[moment-index="${e.origin.momentIndex}"]`+`[register-indices="${o}"]`)).sort(function(t,e){return+t.getAttribute("register-indices-index")-+e.getAttribute("register-indices-index")}),l=Array.from(Q.Circuit.Editor.dragEl.circuitEl.querySelectorAll(`[moment-index="${e.origin.momentIndex}"]`+`[register-indices="${o}"]`)),d=l.filter(function(t,e){return!c.includes(t)}),m=Q.Circuit.Editor.dragEl.querySelector(`[moment-index="${e.origin.momentIndex}"]`+`[register-index="${u[1]}"]`),h=(m||e).getAttribute("gate-symbol");if(x.forEach(function(t){Q.Circuit.Editor.dragEl.circuitEl.circuit.clear$(t.origin.momentIndex,t.origin.registerIndex)}),u.length===c.length)w.push([h,r,u.map(function(t){t-=e.origin.registerIndex;return n=b,Q.Circuit.Editor.dragEl.circuitEl&&(n+=e.origin.registerIndex-Q.Circuit.Editor.dragEl.registerIndex+t),n})]);else if(Q.Circuit.Editor.dragEl.circuitEl===p&&r===e.origin.momentIndex){const g=u.reduce(function(t,e,i){return t[e]=i,t},{});c.forEach(function(t){t=+t.getAttribute("register-index");delete g[t]}),c.forEach(function(t){var e=+t.getAttribute("register-index");Q.Circuit.Editor.dragEl.registerIndex;g[e+y]=+t.getAttribute("register-indices-index")});var a=Object.entries(g).reduce(function(t,e,i){return t[+e[1]]=+e[0],t},[]).filter(function(t){return Q.isUsefulInteger(t)});w.push([e.getAttribute("gate-symbol"),r,a])}else d.forEach(function(t,e){w.push([+t.getAttribute("register-indices-index")?h:Q.Gate.NOOP,+t.getAttribute("moment-index"),+t.getAttribute("register-index")])}),c.forEach(function(t){w.push([+t.getAttribute("register-indices-index")?h:Q.Gate.NOOP,+t.getAttribute("moment-index")+C,+t.getAttribute("register-index")+y])});let t=i+1;for(;t<x.length;){var s=x[t];s.getAttribute("gate-symbol")===h&&s.getAttribute("register-indices")===o?x.splice(t,1):t++}}else Q.Circuit.Editor.dragEl.circuitEl&&x.forEach(function(t){Q.Circuit.Editor.dragEl.circuitEl.circuit.clear$(t.origin.momentIndex,t.origin.registerIndex)}),w.push([e.getAttribute("gate-symbol"),r,[n]])}),w.forEach(function(t){n.set$.apply(n,t)}),Q.Circuit.Editor.onSelectionChanged(p),Q.Circuit.Editor.onCircuitChanged(p),Q.Circuit.Editor.dragEl.circuitEl&&Q.Circuit.Editor.dragEl.circuitEl!==p&&(t=Q.Circuit.Editor.dragEl.circuitEl,Q.Circuit.Editor.onSelectionChanged(t),Q.Circuit.Editor.onCircuitChanged(t)),document.body.removeChild(Q.Circuit.Editor.dragEl),Q.Circuit.Editor.dragEl=null}}}else{Q.Circuit.Editor.dragEl.circuitEl&&(i=Q.Circuit.Editor.dragEl.circuitEl,(originCircuit=i.circuit).history.createEntry$(),Array.from(Q.Circuit.Editor.dragEl.children).forEach(function(t){originCircuit.clear$(t.origin.momentIndex,t.origin.registerIndex)}),Q.Circuit.Editor.onSelectionChanged(i),Q.Circuit.Editor.onCircuitChanged(i));let t=Q.Circuit.Editor.dragEl;Q.Circuit.Editor.dragEl=null,t.classList.add("Q-circuit-clipboard-destroy"),void setTimeout(function(){document.body.removeChild(t),t=null},500)}}},window.addEventListener("mousemove",Q.Circuit.Editor.onPointerMove),window.addEventListener("touchmove",Q.Circuit.Editor.onPointerMove),window.addEventListener("mouseup",Q.Circuit.Editor.onPointerRelease),window.addEventListener("touchend",Q.Circuit.Editor.onPointerRelease),codeConsoleLog=t=>{console.log(t),$("#code-console").html(t.trim().replace(/\n/g,"<br>"))},window.addEventListener("Q.Circuit.evaluate began",function(t){codeConsoleLog("\n\nBeginning evaluation for “"+t.detail.circuit.name+"”\n"+t.detail.circuit.toDiagram()+"\n\n")}),window.addEventListener("Q.Circuit.evaluate progressed",function(t){var e=(""+Math.round(100*t.detail.progress)).padStart(3)+"%",i=Math.round(20*t.detail.progress),r="".padStart(i,"█"),i="".padStart(20-i,"░"),n=t.detail.operationsTotal,o=(""+t.detail.operationsCompleted).padStart(Math.log(n)*Math.LOG10E+1|0," ");codeConsoleLog(r+i+" "+e+"   "+o+" of "+n),t.detail.state}),window.addEventListener("Q.Circuit.evaluate completed",function(t){codeConsoleLog("\nEvaluation completed for “"+t.detail.circuit.name+"”\nwith these results:\n"+t.detail.circuit.report$()+"\n\n\n");t=t.detail.circuit;document.getElementById(t.name+"-report");updateCircuitParts(t)}),window.addEventListener("Q gui altered circuit",function(t){updatePlaygroundFromDom(t.detail.circuit)});const execute=()=>{Q($("#code").val()).setName$(Q.getRandomName$).evaluate$()};$("#code").attr("placeholder",$("#code").text()).text("H  X#0\nI  X#1\n"),execute(),$("#code").on("change keyup paste",execute),$("body").css("background-image","linear-gradient(180deg, #784398 0, #55317a 25%, #321f59 50%, #130d39 75%, #00001f 100%)");